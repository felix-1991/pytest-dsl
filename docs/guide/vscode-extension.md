# VS Code æ‰©å±•

pytest-dsl æä¾›äº†ä¸“é—¨çš„ VS Code æ‰©å±•æ’ä»¶ï¼Œä¸º DSL æ–‡ä»¶æä¾›å®Œæ•´çš„ç¼–è¾‘å™¨æ”¯æŒï¼ŒåŒ…æ‹¬è¯­æ³•é«˜äº®ã€æ™ºèƒ½è¡¥å…¨ã€é”™è¯¯æ£€æŸ¥ç­‰åŠŸèƒ½ï¼Œå¤§å¤§æå‡å¼€å‘ä½“éªŒã€‚

## å®‰è£…

### æ–¹å¼ä¸€ï¼šVS Code æ‰©å±•å•†åº—

1. æ‰“å¼€ VS Code
2. æŒ‰ `Ctrl+Shift+X`ï¼ˆWindows/Linuxï¼‰æˆ– `Cmd+Shift+X`ï¼ˆMacï¼‰æ‰“å¼€æ‰©å±•é¢æ¿
3. æœç´¢ `pytest-dsl`
4. æ‰¾åˆ° **pytest-dsl** æ‰©å±•å¹¶ç‚¹å‡» **å®‰è£…**

### æ–¹å¼äºŒï¼šå‘½ä»¤è¡Œå®‰è£…

```bash
code --install-extension felix-1991.pytest-dsl-vscode-extension
```

### æ–¹å¼ä¸‰ï¼šä»VSIXæ–‡ä»¶å®‰è£…

å¦‚æœä½ æœ‰ `.vsix` æ–‡ä»¶ï¼š

```bash
code --install-extension pytest-dsl.vsix
```

## æ”¯æŒçš„æ–‡ä»¶ç±»å‹

æ‰©å±•è‡ªåŠ¨è¯†åˆ«ä»¥ä¸‹æ–‡ä»¶ç±»å‹ï¼š

- `.dsl` - pytest-dsl æµ‹è¯•æ–‡ä»¶ï¼ˆä¸»è¦æ‰©å±•åï¼‰
- `.pytest-dsl` - pytest-dsl æµ‹è¯•æ–‡ä»¶ï¼ˆå¤‡é€‰æ‰©å±•åï¼‰

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ¨ è¯­æ³•é«˜äº®

æ‰©å±•æä¾›å®Œæ•´çš„ DSL è¯­æ³•é«˜äº®æ”¯æŒï¼š

```python
# æ³¨é‡Šé«˜äº®
@name: "æµ‹è¯•åç§°"  # å…ƒæ•°æ®é«˜äº®
@description: "æµ‹è¯•æè¿°"

# å˜é‡é«˜äº®
username = "admin"
api_url = "https://api.example.com"

# å…³é”®å­—è°ƒç”¨é«˜äº®
[HTTPè¯·æ±‚], å®¢æˆ·ç«¯: "default", é…ç½®: '''
    method: GET
    url: ${api_url}/users
    asserts:
        - ["status", "eq", 200]
'''

# æ§åˆ¶æµé«˜äº®
if ${username} == "admin" do
    [æ‰“å°], å†…å®¹: "ç®¡ç†å‘˜ç™»å½•"
else
    [æ‰“å°], å†…å®¹: "æ™®é€šç”¨æˆ·ç™»å½•"
end

# å‡½æ•°å®šä¹‰é«˜äº®
function ç”¨æˆ·ç™»å½• (ç”¨æˆ·å, å¯†ç ="123456") do
    # å‡½æ•°ä½“
    return ${token}
end
```

### ğŸ’¡ æ™ºèƒ½è¡¥å…¨

#### å…³é”®å­—è¡¥å…¨

è¾“å…¥ `[` åè‡ªåŠ¨æ˜¾ç¤ºå¯ç”¨å…³é”®å­—åˆ—è¡¨ï¼š

- `[HTTPè¯·æ±‚]` - HTTP æ¥å£æµ‹è¯•å…³é”®å­—
- `[æ‰“å°]` - æ‰“å°è¾“å‡ºå…³é”®å­—
- `[æ–­è¨€]` - æ–­è¨€éªŒè¯å…³é”®å­—
- `[ä¼‘çœ ]` - å»¶æ—¶ç­‰å¾…å…³é”®å­—
- `[æ–‡ä»¶æ“ä½œ]` - æ–‡ä»¶è¯»å†™å…³é”®å­—
- ä»¥åŠå…¶ä»–æ‰€æœ‰å†…ç½®å…³é”®å­—...

#### å‚æ•°è¡¥å…¨

é€‰æ‹©å…³é”®å­—åï¼Œè‡ªåŠ¨æ˜¾ç¤ºå‚æ•°æç¤ºï¼š

```python
[HTTPè¯·æ±‚], |  # å…‰æ ‡ä½ç½®ï¼Œæ˜¾ç¤ºå‚æ•°é€‰é¡¹ï¼š
             # - å®¢æˆ·ç«¯
             # - é…ç½®
             # - è¶…æ—¶æ—¶é—´
```

#### å˜é‡è¡¥å…¨

è¾“å…¥ `${` åæ˜¾ç¤ºå½“å‰ä½œç”¨åŸŸå†…çš„å˜é‡ï¼š

```python
username = "admin"
password = "secret"

[HTTPè¯·æ±‚], é…ç½®: '''
    request:
        json:
            username: "${|}"  # æ˜¾ç¤º: username, password
'''
```

#### æ§åˆ¶æµè¡¥å…¨

- è¾“å…¥ `if` è‡ªåŠ¨è¡¥å…¨ `if-do-end` ç»“æ„
- è¾“å…¥ `for` è‡ªåŠ¨è¡¥å…¨ `for-do-end` ç»“æ„
- è¾“å…¥ `function` è‡ªåŠ¨è¡¥å…¨å‡½æ•°å®šä¹‰ç»“æ„

### ğŸ” é”™è¯¯æ£€æŸ¥

æ‰©å±•æä¾›å®æ—¶çš„è¯­æ³•é”™è¯¯æ£€æµ‹ï¼š

#### è¯­æ³•é”™è¯¯æ£€æµ‹

```python
# âŒ è¯­æ³•é”™è¯¯ï¼šç¼ºå°‘ end
if condition do
    [æ‰“å°], å†…å®¹: "hello"
# é”™è¯¯æç¤ºï¼šExpected 'end' keyword

# âŒ è¯­æ³•é”™è¯¯ï¼šå…³é”®å­—æ ¼å¼é”™è¯¯
HTTPè¯·æ±‚], é…ç½®: "..."  # ç¼ºå°‘å¼€å¤´çš„ [
# é”™è¯¯æç¤ºï¼šInvalid keyword format

# âŒ è¯­æ³•é”™è¯¯ï¼šå˜é‡å¼•ç”¨é”™è¯¯
[æ‰“å°], å†…å®¹: "${undefined_var"  # ç¼ºå°‘ç»“æŸçš„ }
# é”™è¯¯æç¤ºï¼šUnclosed variable reference
```

#### è¯­ä¹‰é”™è¯¯æ£€æµ‹

```python
# âŒ è¯­ä¹‰é”™è¯¯ï¼šæœªå®šä¹‰çš„å˜é‡
[æ‰“å°], å†…å®¹: "${unknown_variable}"
# è­¦å‘Šï¼šVariable 'unknown_variable' is not defined

# âŒ è¯­ä¹‰é”™è¯¯ï¼šå‡½æ•°å‚æ•°ä¸åŒ¹é…
function test_func (param1, param2) do
    # å‡½æ•°ä½“
end

[test_func], param1: "value1"  # ç¼ºå°‘ param2
# è­¦å‘Šï¼šMissing required parameter 'param2'
```

### ğŸ“– æ‚¬åœæç¤º

å°†é¼ æ ‡æ‚¬åœåœ¨å…³é”®å­—ã€å˜é‡æˆ–å‡½æ•°ä¸Šï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼š

#### å…³é”®å­—æ‚¬åœ

```python
[HTTPè¯·æ±‚], é…ç½®: "..."  # æ‚¬åœæ˜¾ç¤ºï¼š
                      # HTTPè¯·æ±‚å…³é”®å­—
                      # ç”¨äºå‘é€HTTPè¯·æ±‚å¹¶éªŒè¯å“åº”
                      # å‚æ•°ï¼š
                      # - å®¢æˆ·ç«¯: HTTPå®¢æˆ·ç«¯åç§°
                      # - é…ç½®: è¯·æ±‚é…ç½®ï¼ˆYAMLæ ¼å¼ï¼‰
                      # - è¶…æ—¶æ—¶é—´: è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
```

#### å˜é‡æ‚¬åœ

```python
username = "admin"    # æ‚¬åœæ˜¾ç¤ºï¼š
                      # å˜é‡: username
                      # ç±»å‹: str
                      # å€¼: "admin"

[æ‰“å°], å†…å®¹: "${username}"  # æ‚¬åœ username æ˜¾ç¤ºåŒæ ·ä¿¡æ¯
```

#### å‡½æ•°æ‚¬åœ

```python
function ç™»å½• (ç”¨æˆ·å, å¯†ç ="é»˜è®¤") do
    # å‡½æ•°ä½“
end

token = [ç™»å½•], ç”¨æˆ·å: "admin"  # æ‚¬åœæ˜¾ç¤ºï¼š
                              # å‡½æ•°: ç™»å½•
                              # å‚æ•°: ç”¨æˆ·å, å¯†ç ="é»˜è®¤"
                              # è¿”å›å€¼: token
```

### ğŸ”— å®šä¹‰è·³è½¬

#### è·³è½¬åˆ°å˜é‡å®šä¹‰

```python
username = "admin"    # å˜é‡å®šä¹‰ä½ç½®

# ... å…¶ä»–ä»£ç  ...

[æ‰“å°], å†…å®¹: "${username}"  # Ctrl+Click æˆ– F12 è·³è½¬åˆ°å®šä¹‰
```

#### è·³è½¬åˆ°å‡½æ•°å®šä¹‰

```python
function ç”¨æˆ·ç™»å½• (ç”¨æˆ·å) do  # å‡½æ•°å®šä¹‰ä½ç½®
    # å‡½æ•°ä½“
end

# ... å…¶ä»–ä»£ç  ...

[ç”¨æˆ·ç™»å½•], ç”¨æˆ·å: "admin"  # Ctrl+Click è·³è½¬åˆ°å‡½æ•°å®šä¹‰
```

#### è·³è½¬åˆ°åŒ…å«çš„æ–‡ä»¶

```python
@include: "common_functions.dsl"  # Ctrl+Click è·³è½¬åˆ°æ–‡ä»¶
```

### ğŸ“ æ–‡ä»¶å›¾æ ‡

æ‰©å±•ä¸º DSL æ–‡ä»¶æä¾›ä¸“ç”¨å›¾æ ‡ï¼Œåœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­æ˜“äºè¯†åˆ«ï¼š

- `.dsl` æ–‡ä»¶æ˜¾ç¤ºä¸“é—¨çš„ pytest-dsl å›¾æ ‡
- `.pytest-dsl` æ–‡ä»¶æ˜¾ç¤ºç›¸åŒçš„å›¾æ ‡

## é…ç½®é€‰é¡¹

ä½ å¯ä»¥åœ¨ VS Code è®¾ç½®ä¸­è‡ªå®šä¹‰æ‰©å±•è¡Œä¸ºï¼š

### é€šè¿‡è®¾ç½®ç•Œé¢é…ç½®

1. æ‰“å¼€ VS Code è®¾ç½®ï¼ˆ`Ctrl+,`ï¼‰
2. æœç´¢ `pytest-dsl`
3. è°ƒæ•´ç›¸å…³è®¾ç½®

### é€šè¿‡ settings.json é…ç½®

```json
{
  "pytest-dsl.validation.enabled": true,
  "pytest-dsl.completion.enabled": true,
  "pytest-dsl.completion.includeBuiltinKeywords": true,
  "pytest-dsl.completion.includeVariables": true,
  "pytest-dsl.hover.enabled": true,
  "pytest-dsl.hover.showDocumentation": true,
  "pytest-dsl.format.enabled": true,
  "pytest-dsl.format.indentSize": 4,
  "pytest-dsl.format.useSpaces": true,
  "pytest-dsl.diagnostics.maxProblems": 100,
  "pytest-dsl.trace.server": "off"
}
```

### é…ç½®é€‰é¡¹è¯´æ˜

| é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `validation.enabled` | `true` | å¯ç”¨è¯­æ³•éªŒè¯ |
| `completion.enabled` | `true` | å¯ç”¨æ™ºèƒ½è¡¥å…¨ |
| `completion.includeBuiltinKeywords` | `true` | è¡¥å…¨ä¸­åŒ…å«å†…ç½®å…³é”®å­— |
| `completion.includeVariables` | `true` | è¡¥å…¨ä¸­åŒ…å«å˜é‡ |
| `hover.enabled` | `true` | å¯ç”¨æ‚¬åœæç¤º |
| `hover.showDocumentation` | `true` | æ‚¬åœæ—¶æ˜¾ç¤ºæ–‡æ¡£ |
| `format.enabled` | `true` | å¯ç”¨ä»£ç æ ¼å¼åŒ– |
| `format.indentSize` | `4` | ç¼©è¿›å¤§å° |
| `format.useSpaces` | `true` | ä½¿ç”¨ç©ºæ ¼ç¼©è¿› |
| `diagnostics.maxProblems` | `100` | æœ€å¤§é—®é¢˜æ•°é‡ |
| `trace.server` | `"off"` | è¯­è¨€æœåŠ¡å™¨è·Ÿè¸ªçº§åˆ« |

## å¿«æ·é”®

æ‰©å±•æä¾›ä»¥ä¸‹é»˜è®¤å¿«æ·é”®ï¼š

| å¿«æ·é”® | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `Ctrl+Space` | è§¦å‘è¡¥å…¨ | æ˜¾ç¤ºæ™ºèƒ½è¡¥å…¨åˆ—è¡¨ |
| `F12` | è·³è½¬åˆ°å®šä¹‰ | è·³è½¬åˆ°å˜é‡/å‡½æ•°å®šä¹‰ |
| `Alt+F12` | æŸ¥çœ‹å®šä¹‰ | åœ¨å¼¹çª—ä¸­é¢„è§ˆå®šä¹‰ |
| `Shift+F12` | æŸ¥æ‰¾å¼•ç”¨ | æŸ¥æ‰¾å˜é‡/å‡½æ•°çš„æ‰€æœ‰å¼•ç”¨ |
| `F2` | é‡å‘½åç¬¦å· | é‡å‘½åå˜é‡/å‡½æ•° |
| `Ctrl+Shift+F` | æ ¼å¼åŒ–æ–‡æ¡£ | æ ¼å¼åŒ–å½“å‰æ–‡æ¡£ |

## ä»£ç ç‰‡æ®µ

æ‰©å±•åŒ…å«å¸¸ç”¨çš„ä»£ç ç‰‡æ®µï¼Œæé«˜ç¼–å†™æ•ˆç‡ï¼š

### HTTP æµ‹è¯•ç‰‡æ®µ

è¾“å…¥ `http` + `Tab`ï¼š

```python
[HTTPè¯·æ±‚], å®¢æˆ·ç«¯: "default", é…ç½®: '''
    method: GET
    url: ${1:https://api.example.com}
    asserts:
        - ["status", "eq", ${2:200}]
'''
```

### å‡½æ•°å®šä¹‰ç‰‡æ®µ

è¾“å…¥ `function` + `Tab`ï¼š

```python
function ${1:å‡½æ•°å} (${2:å‚æ•°}) do
    ${3:# å‡½æ•°ä½“}
    return ${4:result}
end
```

### æ¡ä»¶è¯­å¥ç‰‡æ®µ

è¾“å…¥ `if` + `Tab`ï¼š

```python
if ${1:condition} do
    ${2:# ä»£ç å—}
end
```

### å¾ªç¯è¯­å¥ç‰‡æ®µ

è¾“å…¥ `for` + `Tab`ï¼š

```python
for ${1:i} in ${2:range(1, 10)} do
    ${3:# å¾ªç¯ä½“}
end
```

### æ•°æ®é©±åŠ¨ç‰‡æ®µ

è¾“å…¥ `data` + `Tab`ï¼š

```python
@name: "${1:æµ‹è¯•åç§°}"
@data: "${2:data.csv}" using csv

# æµ‹è¯•å†…å®¹
${3:}
```

## è°ƒè¯•æ”¯æŒ

### è¿è¡Œé…ç½®

æ‰©å±•ä¼šè‡ªåŠ¨åˆ›å»º `.vscode/launch.json` é…ç½®ï¼š

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Run pytest-dsl",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/venv/bin/pytest-dsl",
            "args": ["${file}"],
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}"
        },
        {
            "name": "Debug pytest-dsl",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/venv/bin/pytest-dsl",
            "args": ["${file}", "--verbose"],
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "justMyCode": false
        }
    ]
}
```

### è¿è¡Œå’Œè°ƒè¯•

1. **è¿è¡Œå½“å‰æ–‡ä»¶**: `F5` æˆ–ç‚¹å‡»è¿è¡ŒæŒ‰é’®
2. **è°ƒè¯•å½“å‰æ–‡ä»¶**: `Ctrl+F5` æˆ–é€‰æ‹©è°ƒè¯•é…ç½®
3. **è¿è¡Œæ‰€æœ‰æµ‹è¯•**: åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ `pytest-dsl` å‘½ä»¤

## å·¥ä½œåŒºæ”¯æŒ

### å¤šæ–‡ä»¶é¡¹ç›®æ”¯æŒ

æ‰©å±•æ”¯æŒåŒ…å«å¤šä¸ª DSL æ–‡ä»¶çš„é¡¹ç›®ï¼š

```
project/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ api_tests.dsl
â”‚   â”œâ”€â”€ ui_tests.dsl
â”‚   â””â”€â”€ common/
â”‚       â””â”€â”€ functions.dsl
â”œâ”€â”€ data/
â”‚   â””â”€â”€ test_data.csv
â””â”€â”€ pytest-dsl.yaml
```

### è·¨æ–‡ä»¶å¼•ç”¨

æ‰©å±•æ”¯æŒè·¨æ–‡ä»¶çš„å®šä¹‰è·³è½¬å’Œå¼•ç”¨æŸ¥æ‰¾ï¼š

```python
# common/functions.dsl
function é€šç”¨ç™»å½• (ç”¨æˆ·å) do
    # ç™»å½•é€»è¾‘
end

# api_tests.dsl
@include: "common/functions.dsl"

[é€šç”¨ç™»å½•], ç”¨æˆ·å: "admin"  # å¯ä»¥è·³è½¬åˆ° common/functions.dsl
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¯­æ³•é«˜äº®ä¸ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿æ–‡ä»¶æ‰©å±•åä¸º `.dsl` æˆ– `.pytest-dsl`
- é‡å¯ VS Code
- æ£€æŸ¥æ˜¯å¦å®‰è£…äº†å…¶ä»–å†²çªçš„æ‰©å±•

#### 2. æ™ºèƒ½è¡¥å…¨ä¸å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥è®¾ç½®ä¸­çš„ `pytest-dsl.completion.enabled` æ˜¯å¦ä¸º `true`
- ç¡®ä¿ pytest-dsl å·²æ­£ç¡®å®‰è£…ï¼ˆ`pip install pytest-dsl`ï¼‰
- é‡å¯ VS Code è¯­è¨€æœåŠ¡å™¨ï¼š`Ctrl+Shift+P` â†’ "Reload Window"

#### 3. é”™è¯¯æ£€æŸ¥è¯¯æŠ¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ DSL è¯­æ³•æ˜¯å¦æ­£ç¡®
- æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„æ‰©å±•
- åœ¨è®¾ç½®ä¸­è°ƒæ•´ `pytest-dsl.diagnostics.maxProblems`

#### 4. æ€§èƒ½é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å…³é—­ä¸éœ€è¦çš„åŠŸèƒ½ï¼ˆå¦‚æ‚¬åœæç¤ºï¼‰
- å‡å°‘ `diagnostics.maxProblems` çš„å€¼
- æ’é™¤å¤§å‹æ–‡ä»¶æˆ–ç›®å½•

### æ—¥å¿—æŸ¥çœ‹

1. æ‰“å¼€è¾“å‡ºé¢æ¿ï¼š`Ctrl+Shift+U`
2. é€‰æ‹© "pytest-dsl" è¾“å‡ºé¢‘é“
3. æŸ¥çœ‹è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

### æŠ¥å‘Šé—®é¢˜

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·è®¿é—® [GitHub Issues](https://github.com/felix-1991/pytest-dsl-vscode-extension/issues) é¡µé¢æŠ¥å‘Šã€‚

æä¾›ä»¥ä¸‹ä¿¡æ¯æœ‰åŠ©äºå¿«é€Ÿè§£å†³é—®é¢˜ï¼š

- VS Code ç‰ˆæœ¬
- æ‰©å±•ç‰ˆæœ¬
- æ“ä½œç³»ç»Ÿ
- é‡ç°æ­¥éª¤
- é”™è¯¯æˆªå›¾æˆ–æ—¥å¿—

## æ›´æ–°å’Œç‰ˆæœ¬

### è‡ªåŠ¨æ›´æ–°

VS Code é»˜è®¤ä¼šè‡ªåŠ¨æ›´æ–°æ‰©å±•ã€‚ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ£€æŸ¥æ›´æ–°ï¼š

1. æ‰“å¼€æ‰©å±•é¢æ¿ï¼ˆ`Ctrl+Shift+X`ï¼‰
2. ç‚¹å‡»æ‰©å±•å³ä¸Šè§’çš„é½¿è½®å›¾æ ‡
3. é€‰æ‹© "æ£€æŸ¥æ›´æ–°"

### ç‰ˆæœ¬å†å²

å¯ä»¥åœ¨æ‰©å±•è¯¦æƒ…é¡µé¢æŸ¥çœ‹ç‰ˆæœ¬å†å²å’Œæ›´æ–°è¯´æ˜ã€‚

### é™çº§ç‰ˆæœ¬

å¦‚æœæ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥é™çº§åˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼š

1. åœ¨æ‰©å±•é¢æ¿ä¸­æ‰¾åˆ° pytest-dsl æ‰©å±•
2. ç‚¹å‡»é½¿è½®å›¾æ ‡
3. é€‰æ‹© "å®‰è£…å…¶ä»–ç‰ˆæœ¬"
4. é€‰æ‹©è¦å®‰è£…çš„ç‰ˆæœ¬

é€šè¿‡ VS Code æ‰©å±•ï¼Œä½ å¯ä»¥è·å¾—å®Œæ•´çš„ pytest-dsl å¼€å‘ä½“éªŒï¼Œä»ç¼–å†™åˆ°è°ƒè¯•ï¼Œä¸€åˆ‡éƒ½å˜å¾—æ›´åŠ é«˜æ•ˆå’Œä¾¿æ·ã€‚ 